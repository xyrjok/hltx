<div contenteditable="true" translate="no" class="ProseMirror"><h1>CloudCard 项目部署指南 (Full Stack Pages)</h1><p>欢迎！这份指南将指导你如何正确部署你当前的 GitHub 仓库。</p><p>你现在的架构是 "Full Stack Pages"：你的前端 (<code>index.html</code>)和后端 (<code>worker.js</code>) 都在同一个 GitHub 仓库中。这是 Cloudflare Pages <strong>推荐</strong>的方式，因为它更简单、更易于管理。</p><p>请<strong>忽略</strong>之前所有关于“单独部署 Worker”的指南 ，<strong>只看这份</strong>。</p><h2>第一步：在 GitHub 上准备代码</h2><p><strong>你已经完成了！</strong> 你的仓库结构（包含 <code>worker.js</code> 和 <code>_routes.json</code>）是正确的。</p><pre><code>/(你的仓库根目录)
│
├── static/
│   └── style.css
├── admin/
│   ├── index.html
│   └── ... (其他后台文件)
│
├── worker.js           &lt;-- 你的后端 API
├── _routes.json        &lt;-- 你的路由规则
├── index.html          &lt;-- 你的前端首页
├── product.html
└── ... (其他前端文件)
<br class="ProseMirror-trailingBreak"></code></pre><h2>第二步：在 Cloudflare 上创建 Pages 项目</h2><ol><li><p>登录 Cloudflare 仪表板 -&gt; <strong>Workers &amp; Pages</strong>。</p></li><li><p>点击 <strong>"Create Application" (创建应用)</strong> -&gt; <strong>"Pages"</strong> -&gt; <strong>"Connect to Git" (连接到 Git)</strong>。</p></li><li><p>选择你的 GitHub 账号并<strong>选择你的 <code>my-card-site</code> 仓库</strong>。</p></li><li><p>点击 <strong>"Begin setup" (开始设置)</strong>。</p></li><li><p><strong>【构建设置 - 关键！】</strong></p><ul><li><p><strong>Project name (项目名称):</strong> <code>my-card-site</code> (或你喜欢的)</p></li><li><p><strong>Build command (构建命令):</strong> <code>(留空)</code></p></li><li><p><strong>Build output directory (构建输出目录):</strong> <code>(留空)</code></p></li></ul></li><li><p>点击 <strong>"Save and Deploy" (保存并部署)</strong>。</p></li></ol><p>Cloudflare 将会部署你的<strong>前端文件</strong>，并且<strong>自动</strong>识别和部署你的 <code>worker.js</code> 作为后端 API。</p><h2>第三步：绑定 D1 数据库和环境变量</h2><p>部署完成后，你的后端 <code>worker.js</code> 还需要知道<strong>数据库在哪里</strong>以及你的<strong>管理员密码</strong>是什么。</p><ol><li><p>在 Cloudflare 仪表板，进入你刚创建的 <strong>Pages 项目</strong> (例如 <code>my-card-site</code>)。</p></li><li><p>点击 <strong>"Settings" (设置)</strong> -&gt; <strong>"Functions" (函数)</strong>。</p></li><li><p><strong>绑定 D1 数据库:</strong></p><ul><li><p>向下滚动到 <strong>"D1 database bindings" (D1 数据库绑定)</strong>。</p></li><li><p>点击 <strong>"Add binding" (添加绑定)</strong>:</p><ul><li><p>Variable name (变量名): <code>DB</code></p></li><li><p>D1 Database: <code>card-database</code> (选择你之前创建的)</p></li></ul></li><li><p>点击 <strong>"Save" (保存)</strong>。</p></li></ul></li><li><p><strong>绑定后台密码 (Secrets):</strong></p><ul><li><p>向下滚动到 <strong>"Environment Variable Secrets" (环境变量密钥)</strong>。</p></li><li><p>点击 <strong>"Add variable" (添加变量)</strong>，添加 3 次：</p><ol><li><p><strong>Name:</strong> <code>ADMIN_USER</code>, <strong>Value:</strong> <code>你设置的管理员帐号</code></p></li><li><p><strong>Name:</strong> <code>ADMIN_PASS</code>, <strong>Value:</strong> <code>你设置的管理员密码</code></p></li><li><p><strong>Name:</strong> <code>ADMIN_TOKEN</code>, <strong>Value:</strong> <code>super-secret-admin-token-xyz</code> (或你自定义的)</p></li></ol></li><li><p>每次添加后都点击 <strong>"Save"</strong>。</p></li></ul></li></ol><h2>第四步：完成与测试</h2><p>你<strong>不需要</strong>做任何其他事情了。你的 <code>_routes.json</code> 文件（<code>"version": 1, "include": ["/api/*"]</code>）会自动告诉 Cloudflare 把所有 <code>/api/</code> 请求都转发给 <code>worker.js</code>。</p><ol><li><p><strong>触发一次新部署：</strong></p><ul><li><p>回到你的 GitHub 仓库，随便修改一点东西（比如在 <code>README.md</code> 里加个空格）然后<strong>提交 (Commit)</strong>。</p></li><li><p>Cloudflare Pages 会自动检测到这个提交，并<strong>重新部署</strong>你的项目（这次会带上你刚设置的数据库和密码）。</p></li></ul></li><li><p><strong>测试：</strong></p><ul><li><p>等待部署完成后，访问你的 <code>https://my-card-site.pages.dev</code> 网址。</p></li><li><p>你的首页现在应该能<strong>成功加载</strong>分类和商品了。</p></li><li><p>访问 <code>/admin/</code> 应该能看到<strong>帐号+密码</strong>登录框，并且可以成功登录。</p></li></ul></li></ol><h3>(可选) 第五步：安全加固 (Cloudflare Access)</h3><p>虽然你现在有了帐号密码，但你的登录 API 仍然暴露在公网上。使用 Cloudflare Access (零信任) 是最安全的方法。</p><p><strong>如果你决定使用 Access：</strong></p><ol><li><p>登录 Cloudflare -&gt; <strong>Zero Trust</strong> -&gt; <strong>Access</strong> -&gt; <strong>Applications</strong>。</p></li><li><p>添加一个 "Self-hosted" 应用。</p></li><li><p><strong>Hostname:</strong> <code>my-card-site.pages.dev</code></p></li><li><p><strong>Path:</strong> <code>/admin*</code> (保护整个后台目录)</p></li><li><p>创建一个 "Allow" (允许) 规则，<strong>只允许你自己的邮箱</strong>。</p></li><li><p>保存后，Cloudflare Access 会在你的帐号密码登录页<strong>之前</strong>就拦截所有请求，要求用邮箱验证码登录，提供双重保护。</p></li></ol></div>
